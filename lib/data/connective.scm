(library (data connective)
  (export & || ! and? or? not? children)
  (import (rnrs (6))
	        (exn contract) 
          (data primitive) (data node))
  
  (define-record-type (And AND and?)
    (fields (immutable children and-children))
    (parent Node))
  (define-record-type (Or OR or?)
    (fields (immutable children or-children))
    (parent Node))
  (define-record-type (Not NOT not?)
    (fields (immutable children not-children))
    (parent Node))

  (define (check-node-list name l)
    (for-each
     (lambda (n)
       (unless (node? n)
	      (raise-contract-error name "node?" n)))
     l))
  
  (define (& . c)
    (check-node-list '& c)
    (AND c))
  (define (|| . c)
    (check-node-list '|| c)
    (OR c))
  (define (! c)
    (check-node-list '! (list c))
    (NOT (list c)))
  
  (define (children rc)
    (cond ((and? rc) (and-children rc))
	  ((or? rc) (or-children rc))
	  ((not? rc) (not-children rc))
    (else (raise-contract-error 'children "(or/c and? or? not?)" rc))))
  )

