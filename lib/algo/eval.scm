(library (algo eval)
    (export eval-proposition)
    (import (data connective) (data primitive) (algo list) (exn contract) (exn internal) (srfi srfi-28) (rnrs (6)))
    
    (define (eval-proposition tree env)
        (unless (alist? env)
            (raise-contract-error 'eval-proposition "alist?" env))
        (define (assoc/check v l)
            (define r (assoc v l))
            (if r r (raise-internal-error 'eval-proposition (format "~s not found in ~s" v l))))
        (let loop ((tree tree) (env env))
            (cond ((and? tree) (andmap (lambda (st) (loop st env)) (children tree)))
                  ((or? tree) (ormap (lambda (st) (loop st env)) (children tree)))
                  ((not? tree) (not (loop (car (children tree)) env)))
                  ((primitive? tree) (cdr (assoc/check (primitive-name tree) env)))
                  (else (raise-contract-error 'eval-proposition "node?" tree)))))
    )